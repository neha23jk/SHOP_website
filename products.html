<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - FlashMart</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
   
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <svg class="logo-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                </svg>
                FlashMart
            </a>
            <div class="search-bar">
                <input type="text" class="search-input" id="search-input" placeholder="Search for products..." value="">
                <button class="search-btn" onclick="handleSearch()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </button>
            </div>
            <div class="header-actions">
                <span id="user-info">Guest</span>
                <a href="login.html" class="btn btn-secondary" id="login-btn">Login</a>
                <button class="btn btn-secondary" id="logout-btn" onclick="handleLogout()" style="display: none;">Logout</button>
                <a href="cart.html" class="btn btn-primary cart-btn">
                    Cart
                    <span class="cart-badge" id="cart-badge">0</span>
                </a>
            </div>
        </div>
    </header>

  
    <nav class="nav-menu">
        <div class="nav-container">
            <a href="index.html" class="nav-link">Home</a>
            <a href="products.html?category=groceries" class="nav-link">Groceries</a>
            <a href="products.html?category=snacks" class="nav-link">Snacks</a>
            <a href="products.html?category=personal-care" class="nav-link">Personal Care</a>
            <a href="products.html?category=electronics" class="nav-link">Electronics</a>
            <a href="products.html?category=stationery" class="nav-link">Stationery</a>
            <a href="products.html?category=home-essentials" class="nav-link">Home Essentials</a>
            <a href="products.html" class="nav-link">All Products</a>
            <a href="account.html" class="nav-link">Account</a>
        </div>
    </nav>

   
    <section class="products-section">
        <h2 class="section-title" id="page-title">All Products</h2>
        
        
        <div class="filters-section">
            <div class="filter-group">
                <label class="filter-label">Category:</label>
                <select class="filter-select" id="category-filter" onchange="applyFilters()">
                    <option value="all">All Categories</option>
                    <option value="groceries">Groceries</option>
                    <option value="snacks">Snacks</option>
                    <option value="personal-care">Personal Care</option>
                    <option value="electronics">Electronics</option>
                    <option value="stationery">Stationery</option>
                    <option value="home-essentials">Home Essentials</option>
                </select>
            </div>
            <div class="filter-group">
                <label class="filter-label">Sort by:</label>
                <select class="filter-select" id="sort-filter" onchange="applyFilters()">
                    <option value="default">Default</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="rating">Rating: High to Low</option>
                </select>
            </div>
        </div>

        
        <div class="products-grid" id="products-grid">
            
        </div>

        
        <div class="empty-state hidden" id="empty-state">
            <div class="empty-state-icon">üîç</div>
            <div class="empty-state-text">No products found</div>
        </div>
    </section>

    
    <script src="data/products.js"></script>
    <script src="js/app.js"></script>
    <script>
        let allProducts = [];
        let filteredProducts = [];

       
        function handleSearch() {
            const query = document.getElementById('search-input').value.trim();
            if (query) {
                window.location.href = `products.html?search=${encodeURIComponent(query)}`;
            }
        }

       
        document.getElementById('search-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });

     
        function handleLogout() {
            FlashMartStorage.logoutUser();
            FlashMartStorage.updateUserInfo();
            FlashMartStorage.updateCartBadge();
            window.location.href = 'index.html';
        }


        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                category: params.get('category') || 'all',
                search: params.get('search') || '',
                sort: params.get('sort') || 'default'
            };
        }

       
        function loadProducts() {
            const params = getUrlParams();
            allProducts = FlashMartStorage.getProducts();

           
            if (params.search) {
                allProducts = FlashMartStorage.searchProducts(params.search);
                document.getElementById('page-title').textContent = `Search Results: "${params.search}"`;
            } else if (params.category !== 'all') {
                allProducts = FlashMartStorage.getProductsByCategory(params.category);
                document.getElementById('page-title').textContent = `${params.category.charAt(0).toUpperCase() + params.category.slice(1)}`;
            }

          
            document.getElementById('category-filter').value = params.category;

            filteredProducts = [...allProducts];
            applySorting();
            renderProducts();
        }

       
        function applyFilters() {
            const category = document.getElementById('category-filter').value;
            const sort = document.getElementById('sort-filter').value;

           
            const url = new URL(window.location);
            url.searchParams.set('category', category);
            url.searchParams.set('sort', sort);
            window.history.pushState({}, '', url);

            
            if (category === 'all') {
                filteredProducts = FlashMartStorage.getProducts();
            } else {
                filteredProducts = FlashMartStorage.getProductsByCategory(category);
            }

           
            const search = getUrlParams().search;
            if (search) {
                filteredProducts = FlashMartStorage.searchProducts(search);
            }

            applySorting();
            renderProducts();
        }

       
        function applySorting() {
            const sort = document.getElementById('sort-filter')?.value || getUrlParams().sort;

            switch (sort) {
                case 'price-low':
                    filteredProducts.sort((a, b) => a.price - b.price);
                    break;
                case 'price-high':
                    filteredProducts.sort((a, b) => b.price - a.price);
                    break;
                case 'rating':
                    filteredProducts.sort((a, b) => b.rating - a.rating);
                    break;
                default:

                    break;
            }
        }

       
        function renderProducts() {
            const container = document.getElementById('products-grid');
            const emptyState = document.getElementById('empty-state');

            if (filteredProducts.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            container.innerHTML = filteredProducts.map(product => `
                <div class="product-card">
                    <a href="product.html?id=${product.id}" style="text-decoration: none; color: inherit;">
                                <div class="product-image-wrapper">
                            <img src="${product.images[0]}" alt="${product.name}" class="product-image">
                        </div>
                        <div class="product-info">
                            <div class="product-name">${product.name}</div>
                            <div class="product-price">${FlashMartStorage.formatPrice(product.price)}</div>
                            <div class="product-rating">
                                <span class="star">‚òÖ</span>
                                <span>${product.rating}</span>
                            </div>
                            <div class="product-stock">In Stock (${product.stock})</div>
                        </div>
                    </a>
                    <div class="product-actions">
                        <button class="btn-add-cart" onclick="addToCart(${product.id}, event)">Add to Cart</button>
                        <a href="product.html?id=${product.id}" class="btn-buy-now">Buy Now</a>
                    </div>
                </div>
            `).join('');
        }

       
        function addToCart(productId, event) {
            const button = event ? event.target : null;
            const result = FlashMartStorage.addToCart(productId, 1);
            if (result.success) {
                if (button) {
                    FlashMartStorage.animateAddToCart(productId, button);
                }
                FlashMartStorage.showToast(result.message, 'success');
                FlashMartStorage.updateCartBadge();
            } else {
                FlashMartStorage.showToast(result.message, 'error');
            }
        }

       
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            FlashMartStorage.updateCartBadge();
            FlashMartStorage.updateUserInfo();

            
            const sort = getUrlParams().sort;
            if (sort && document.getElementById('sort-filter')) {
                document.getElementById('sort-filter').value = sort;
            }

            
            const params = getUrlParams();
            if (params.search) {
                document.getElementById('search-input').value = params.search;
            }

        });
    </script>
</body>
</html>

